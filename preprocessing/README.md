# 데이터 전처리 (Data Preprocessing)

한국 건설업계 경기 예측을 위한 ECOS 경제지표 및 DART 재무데이터 전처리 과정

## 📁 파일 구조
```
preprocessing/
├── test____.ipynb         # 전체 전처리 노트북 (개발용)
├── preprocessing.ipynb    # 전처리 노트북 (통합용)
└── README.md             # 이 파일
```

## 📊 최종 데이터셋
- **통합 데이터**: `integrated_data` (1,110 × 28)
  - 기업: 10개 건설업체
  - 기간: 2015년 10월 ~ 2024년 12월 (111개월)
  - 변수: corp_name + date + 재무지표 6개 + 경제지표 20개
- **ECOS 데이터**: `ecos_scaled_df` (119 × 20)
- **DART 데이터**: `dart_scaled_df_final` (1,110 × 8)

## 🔄 전처리 과정

### 1. ECOS 경제 데이터 전처리

#### 1.1 데이터 로드
- **파일**: `../ecos/economic_data_merged.csv`
- **데이터 크기**: 120개 행 × 20개 컬럼
- **기간**: 2015년 10월 ~ 2025년 9월
- **포함 지표**: 
  - 금리: 기준금리, 국고채, 회사채
  - 물가: CPI, PPI, 수입물가
  - 환율: 원/달러
  - 경기: BSI, ESI, CCSI, 선행지수
  - 부동산: 매매가격지수, 전세가격지수
  - 통화: M2 증가율

#### 1.2 날짜 전처리
- **변환**: YYYYMM 형식 → datetime 형식
- **월말일 변경**: 각 월의 마지막 날로 변경
  ```python
  ecos_data['date'] = ecos_data['date'] + pd.offsets.MonthEnd(0)
  ```
- **결과**: 2015-10-31 ~ 2025-08-31

#### 1.3 기간 조정
- **현재 달 제외**: 2025년 9월 데이터 제거
- **최종 기간**: 2015년 10월 ~ 2025년 8월 (119개월)
- **사유**: 현재 진행 중인 달의 불완전한 데이터 제외

#### 1.4 시각화 분석
##### 주요 경제지표 시계열 그래프
- 한국은행 기준금리: 2020년 급등 후 2024년부터 하락 추세
- 소비자물가지수: 지속적 상승 추세
- 원/달러 환율: 2022년 급등 후 변동성 지속
- 건설업 BSI 실적: 기준선(100) 대비 대부분 하회

##### 상관관계 분석
건설업 BSI 실적과의 상관관계 (상위 5개):
1. **건설업 BSI 전망**: 0.91 (매우 높음)
2. **경제심리지수(ESI)**: 0.90 (매우 높음)
3. **선행지수**: 0.70 (높음)
4. **CCSI**: 0.45 (중간)
5. **수입물가지수(철강)**: 0.44 (중간)

#### 1.5 데이터 스케일링
- **방법**: StandardScaler (평균 0, 표준편차 1)
- **대상**: 모든 수치형 컬럼 (날짜 제외)
- **결측값 처리**: Forward fill → Backward fill
- **결과 변수**: `ecos_scaled_df`

### 2. DART 건설업 재무 데이터 전처리

#### 2.1 데이터 로드
- **파일**: `../dart/dart_out/건설10_11년로드_2015~2024_연결_분기재무_정규화.csv`
- **데이터 크기**: 370개 행 × 11개 컬럼
- **포함 기업**: 건설업 상위 10개 기업
  - DL이앤씨, 현대건설, 태영건설, 아이에스동서, 삼성물산
  - 대우건설, HJ중공업, HDC현대산업개발, GS건설, 효성중공업
- **기간**: 2015~2024년 분기별 데이터
- **재무지표**: 자산총계, 부채총계, 자본총계, 매출액, 영업이익, 분기순이익

#### 2.2 분기 → 월별 데이터 변환 (스텝보간법)
- **목적**: ECOS 월별 데이터와 통합을 위한 시계열 일치
- **방법**: 각 분기 데이터를 해당 분기 3개월에 동일하게 복제
- **날짜 기준**: 각 월의 마지막 날 (월말일)
- **변환 결과**: 370개 행 → 1,110개 행 (3배 증가)
- **구현**:
  ```python
  def quarter_to_monthly_dates(year, quarter):
      # Q1: 1,2,3월 / Q2: 4,5,6월 / Q3: 7,8,9월 / Q4: 10,11,12월
      # 각 월의 마지막 날로 날짜 생성
  ```

#### 2.3 불필요한 컬럼 제거
- **제거 컬럼**: corp_code, report_date, year, quarter
- **유지 컬럼**: corp_name (기업명 기준으로 분석)
- **최종 컬럼**: date, corp_name, 6개 재무지표

#### 2.4 결측치 처리 (수정 필요)
- **방법**: 기업별 개별 시계열 선형보간
- **단계**:
  1. 기업별로 데이터 분리
  2. 날짜 순으로 정렬
  3. 선형보간 (linear interpolation)
  4. Forward fill → Backward fill
- **결과**: 결측치 제거

#### 2.5 데이터 스케일링
- **방법**: StandardScaler (평균 0, 표준편차 1)
- **대상**: 6개 재무지표 (날짜, 기업명 제외)
- **결과 변수**: `dart_scaled_df_final`

#### 2.6 데이터 정렬
- **1차 기준**: 기업명 (가나다순)
- **2차 기준**: 날짜 (시간순)
- **최종 형태**: 1,110개 행 × 8개 컬럼

### 3. ECOS-DART 데이터 통합

#### 3.1 통합 전 준비
- **ECOS 데이터**: 119개 월 × 20개 경제지표
- **DART 데이터**: 1,110개 행 (10개 기업 × 111개 월) × 6개 재무지표
- **공통 기간**: 2015년 10월 ~ 2024년 12월

#### 3.2 데이터 통합 수행
- **방법**: 날짜(date) 기준 Inner Join
- **결과**: 각 기업별로 경제지표가 추가된 통합 데이터
- **최종 구조**:
  ```
  컬럼 순서:
  0. corp_name (기업명)
  1. date (날짜)
  2-7. DART 재무지표 (6개)
  8-27. ECOS 경제지표 (20개)
  ```

#### 3.3 통합 결과
- **데이터 형태**: 1,110개 행 × 28개 컬럼
- **기업별 데이터**: 각 111개 월별 데이터
- **변수명**: `integrated_data`
- **모든 변수**: 표준화 완료 (StandardScaler)

## 📊 주요 인사이트

### 경제지표 특성
1. **높은 상관관계 그룹**: BSI 전망, ESI, 선행지수
2. **금리 민감도**: 기준금리와 시장금리 간 높은 연동성
3. **물가 안정성**: CPI는 꾸준한 상승세, PPI는 변동성 존재
4. **환율 영향**: 원달러 환율이 수입물가에 직접적 영향

### 건설업 특성
1. **경기 선행성**: ESI, 선행지수와 높은 상관관계
2. **기대심리**: BSI 전망과 실적 간 강한 연관성
3. **소비심리**: CCSI와 중간 수준의 상관관계

### 데이터 통합 효과
1. **시계열 일치**: 월말일 기준으로 완벽한 날짜 매칭
2. **변수 확장**: 기업별 재무지표 + 거시경제지표 조합
3. **예측 모델링 준비**: 표준화된 통합 데이터셋 구축
4. **기업별 분석**: 10개 건설업체의 경제 민감도 개별 분석 가능

## 🛠 기술적 세부사항

### 사용된 라이브러리
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.preprocessing import StandardScaler
```

### 주요 전처리 함수
```python
# 날짜 월말일 변환
pd.to_datetime() + pd.offsets.MonthEnd(0)

# 분기 → 월별 데이터 변환
def quarter_to_monthly_dates(year, quarter):
    # 각 분기를 3개월로 확장

# 표준화 스케일링
StandardScaler().fit_transform()

# 기업별 시계열 선형보간
for corp in companies:
    corp_data[col].interpolate(method='linear')

# 데이터 통합
pd.merge(dart_data, ecos_data, on='date', how='inner')

# 결측값 처리
df.fillna(method='ffill').fillna(method='bfill')
```

## 📈 다음 단계
1. ✅ **ECOS 경제데이터 전처리** - 완료
2. ✅ **DART 재무데이터 전처리** - 완료  
3. ✅ **ECOS-DART 데이터 통합** - 완료
4. 🔄 **피처 엔지니어링**: 시차변수, 이동평균, 변화율 생성
5. 🔄 **시계열 예측 모델**: LSTM, ARIMA, Prophet 등
6. 🔄 **모델 평가**: MAE, RMSE, MAPE 등 성능 지표
7. 🔄 **대시보드 구축**: 실시간 예측 시스템

## 📝 참고사항
- 모든 날짜는 월말일 기준으로 통일
- DART 분기데이터는 스텝보간법으로 월별 변환
- 결측값은 기업별 시계열 특성을 고려하여 선형보간 적용
- 모든 수치형 변수는 StandardScaler로 표준화 완료
- 통합 데이터는 기업명-날짜 순으로 정렬
- 최종 데이터셋: 1,110개 행 × 28개 컬럼 (10개 기업 × 111개월 × 26개 변수)
