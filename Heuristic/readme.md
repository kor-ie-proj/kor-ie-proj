# 건설업 기업 재무 위험도 평가 휴리스틱 모델

## 개요
본 프로젝트는 건설업 상장기업의 재무제표 데이터와 경제지표를 활용하여 기업의 재무 위험도를 예측하는 휴리스틱 모델입니다. 재무지표와 거시경제지표를 조합하여 기업의 미래 위험도를 4단계(안전, 주의, 위험, 매우위험)로 분류합니다.

## 데이터 구조

### 1. 재무제표 데이터 (DART)
**파일**: `dart_with_economic_indicators.csv`

**기본 정보**:
- 기업명 (corp_name)
- 연도 (year)
- 분기 (quarter): Q1, Q2, Q3, Q4

**재무지표 (7개)**:
- `부채비율`: 총부채 / 총자본 × 100 (%)
- `자기자본비율`: 자기자본 / 총자산 × 100 (%)
- `ROA`: 당기순이익 / 총자산 × 100 (%)
- `ROE`: 당기순이익 / 자기자본 × 100 (%)
- `매출액성장률`: (당기매출액 - 전년동기매출액) / 전년동기매출액 × 100 (%)
- `영업이익성장률`: (당기영업이익 - 전년동기영업이익) / 전년동기영업이익 × 100 (%)
- `순이익성장률`: (당기순이익 - 전년동기순이익) / 전년동기순이익 × 100 (%)

### 2. 경제지표 데이터 (ECOS)
**경제지표 (5개)**:
- `construction_bsi_actual`: 건설업체 경기실사지수 (실적)
- `base_rate`: 한국은행 기준금리 (%)
- `housing_sale_price`: 주택매매가격지수
- `m2_growth`: 통화증가율 (M2) (%)
- `credit_spread`: 신용스프레드 (회사채3년AA - 국고채3년) (bp)

## 파생 변수 생성

### 1. 위험 플래그 (Risk Flags)
8개 위험 플래그를 이진 변수(0 또는 1)로 계산:

```python
# 완전자본잠식: 자본총계 < 0
완전자본잠식 = (자본총계 < 0)

# 연속매출감소: 최근 3분기 중 2분기 이상 매출액성장률 < 0
연속매출감소 = rolling(매출액성장률 < 0, window=3).sum() >= 2

# 고부채비율: 부채비율 >= 200%
고부채비율 = (부채비율 >= 200)

# 영업손실연속: 최근 4분기 중 3분기 이상 영업이익 < 0
영업손실연속 = rolling(영업이익 < 0, window=4).sum() >= 2

# ROA악화: ROA < -5%
ROA악화 = (ROA < -5)

# 자기자본부족: 자기자본비율 < 20%
자기자본부족 = (자기자본비율 < 20)

# 매출급감: 매출액성장률 < -30%
매출급감 = (매출액성장률 < -30)

# 영업이익성장률악화: 최근 3분기 중 2분기 이상 영업이익성장률 < 0
영업이익성장률악화 = rolling(영업이익성장률 < 0, window=3).sum() >= 2
```

### 2. 플래그 점수 (Flag Score)
각 위험 플래그에 가중치를 적용하여 계산:

```python
risk_weights = {
    '완전자본잠식': 10,
    'ROA악화': 6,
    '영업손실연속': 5,
    '고부채비율': 4,
    '연속매출감소': 3,
    '자기자본부족': 3,
    '매출급감': 2,
    '영업이익성장률악화': 1
}

flag_score = Σ(위험플래그 × 가중치)
```

### 3. 상대평가 점수 (0-10 스케일)
각 재무지표와 경제지표를 상대평가하여 0-10점으로 변환:

```python
def calculate_relative_score(series, reverse=False):
    percentile_rank = series.rank(pct=True)
    if reverse:  # 높을수록 위험한 지표
        score = percentile_rank × 10
    else:  # 높을수록 안전한 지표
        score = (1 - percentile_rank) × 10
    return score
```

**재무지표 점수**:
- `debt_score`: 부채비율 상대점수 (높을수록 위험 = reverse=True)
- `equity_score`: 자기자본비율 상대점수 (높을수록 안전 = reverse=False)
- `roa_score`: ROA 상대점수 (높을수록 안전)
- `roe_score`: ROE 상대점수 (높을수록 안전)
- `sales_growth_score`: 매출액성장률 상대점수 (높을수록 안전)
- `profit_growth_score`: 영업이익성장률 상대점수 (높을수록 안전)
- `net_growth_score`: 순이익성장률 상대점수 (높을수록 안전)

**경제지표 점수**:
- `bsi_score`: 건설업체 경기실사지수 상대점수 (높을수록 안전)
- `rate_score`: 기준금리 상대점수 (높을수록 위험)
- `housing_score`: 주택매매가격지수 상대점수 (높을수록 안전)
- `m2_score`: 통화증가율 상대점수 (높을수록 안전)
- `spread_score`: 신용스프레드 상대점수 (높을수록 위험)

### 4. 기업 규모별 가중치
자산총계 기준으로 기업 규모를 분류하고 부채비율에 차등 가중치 적용:

```python
# 기업 규모 분류
if 자산총계 >= 10조: company_size = "대기업"
elif 자산총계 >= 1조: company_size = "중견기업"
else: company_size = "중소기업"

# 부채비율 가중치
debt_weight = {
    "대기업": 0.5,      # 대기업은 부채 부담 상대적으로 낮음
    "중견기업": 0.75,
    "중소기업": 1.0
}

debt_score_final = debt_score_base × debt_weight
```

## 모델 파라미터

### 휴리스틱 가중치 (Optuna 최적화 결과)
총 13개 요소에 대한 가중치 (합계 = 1.0):

**재무지표 가중치 (총 73.4%)**:
- `flag_score`: 0.2186 (21.9%)
- `debt_score`: 0.1648 (16.5%)
- `equity_score`: 0.1041 (10.4%)
- `roa_score`: 0.1165 (11.6%)
- `roe_score`: 0.0219 (2.2%)
- `sales_growth_score`: 0.0219 (2.2%)
- `profit_growth_score`: 0.0112 (1.1%)
- `net_growth_score`: 0.0476 (4.8%)

**경제지표 가중치 (총 26.6%)**:
- `bsi_score`: 0.0852 (8.5%)
- `rate_score`: 0.0749 (7.5%)
- `housing_score`: 0.0088 (0.9%)
- `m2_score`: 0.0667 (6.7%)
- `spread_score`: 0.0577 (5.8%)

### 최종 위험점수 계산
```python
heuristic_score = (
    flag_score × 0.2186 +
    debt_score × 0.1648 +
    equity_score × 0.1041 +
    roa_score × 0.1165 +
    roe_score × 0.0219 +
    sales_growth_score × 0.0219 +
    profit_growth_score × 0.0112 +
    net_growth_score × 0.0476 +
    bsi_score × 0.0852 +
    rate_score × 0.0749 +
    housing_score × 0.0088 +
    m2_score × 0.0667 +
    spread_score × 0.0577
) × 10
```

### 위험도 분류 임계값
Optuna 최적화를 통해 도출된 임계값:

```python
def assign_heuristic_label(score):
    if score <= 20.31: return 0      # 안전
    elif score <= 35.45: return 1    # 주의
    elif score <= 56.42: return 2    # 위험
    else: return 3                   # 매우위험
```

## 최종 출력 결과

### 1. 위험점수 (heuristic_score)
- **범위**: 0 ~ 100
- **의미**: 높을수록 위험한 상태
- **계산**: 재무지표(73.4%) + 경제지표(26.6%)의 가중평균

### 2. 위험등급 (heuristic_label)
- **0 (안전)**: 점수 ≤ 20.31
- **1 (주의)**: 20.31 < 점수 ≤ 35.45
- **2 (위험)**: 35.45 < 점수 ≤ 56.42
- **3 (매우위험)**: 점수 > 56.42

### 3. 모델 성능 지표
- **정확도 (Accuracy)**: 다음 분기 위험도 예측 정확도
- **MAE (Mean Absolute Error)**: 점수 예측의 평균 절대 오차
- **Direction Accuracy**: 위험도 증감 방향 예측 정확도
- **ROC-AUC**: 위험 vs 안전 이진 분류 성능
- **PR-AUC**: 위험 기업 탐지 성능

### 4. 활용 결과
- **위험 기업 랭킹**: 최신 분기 기준 위험점수 상위 기업
- **안전 기업 랭킹**: 최신 분기 기준 위험점수 하위 기업
- **기업별 시계열 추이**: 개별 기업의 분기별 위험도 변화
- **예측 결과**: 현재 분기 정보로 다음 분기 위험도 예측

## 데이터 전처리

### 1. 경제지표 시프트
경제지표를 1분기 앞으로 이동하여 예측 구조 생성:
```
구조: t-1분기 재무지표 + t분기 경제지표 → t분기 위험도 예측
```

### 2. 결측치 처리
- 핵심 재무지표(자산총계, 부채비율, ROA) 결측 시 해당 관측치 제외
- 경제지표 결측치는 중앙값으로 대체

### 3. 이상값 처리
각 지표별로 클리핑 적용:
- 부채비율: 0 ~ 500%
- ROA: -50 ~ 50%
- ROE: -100 ~ 100%
- 성장률 지표들: 각각 적절한 범위로 제한

## 파일 구조
- `Heuristc_test.ipynb`: 메인 분석 노트북
- `dart_with_economic_indicators.csv`: 입력 데이터
- `construction_linear_model_results.csv`: 분석 결과 출력
- `README.md`: 본 문서

## 사용법
1. 필요한 라이브러리 설치 및 데이터 로드
2. 위험 플래그 계산 및 상대평가 점수 생성
3. Optuna를 통한 하이퍼파라미터 최적화 (선택사항)
4. 휴리스틱 점수 계산 및 위험등급 분류
5. 모델 평가 및 결과 분석
6. 시각화 및 랭킹 생성

## 모델의 특징
- **해석가능성**: 각 요소별 가중치가 명확하여 결과 해석이 용이
- **실시간 활용**: 복잡한 모델 학습 없이 새로운 데이터에 즉시 적용 가능
- **경제상황 반영**: 거시경제지표를 포함하여 외부 환경 변화 고려
- **규모별 차등화**: 기업 규모에 따른 차등 가중치로 현실적 평가
- **최적화**: Optuna를 통한 하이퍼파라미터 튜닝으로 예측 성능 극대화
